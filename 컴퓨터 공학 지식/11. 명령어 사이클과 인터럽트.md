# 11. ****명령어 사이클과 인터럽트****

중요!!

### 명령어 사이클

CPU가 메모리에서 어떤 프로그램을 실행 할 때 메모리에 있는 저장되어 있는 명령어와 데이터를 가지고 와서 실행하는데 일정한 패턴 (정해진 흐름 주기)을 **명령어 사이클**이라 한다. 

메모리에 있는 값을 CPU 레지스터 혹은 내부로 가지고 오는데 이를 **인출** 이라고 한다.  

일반적인 사이클

- 인출 사이클: 메모리에서 인출 하는 주기
- 실행 사이클: 값을 실행 하는 주기
    
    인출 - 실행 -인출 - 실행 - 인출 - 실행
    

CPU로 명령어를 가지고 와도 실행 불가능한 경우 

- 간접 사이클 추가
    
    Ex. 간접 주소 지정 방식 - 메모리 접근이 더 필요한 경우 
    
    인출 사이클 - 간접 사이클 - 실행 사이클 
    

정해진 흐름 방해하는 신호는 인터럽트이다.

### 인터럽트(**interrupt**)

- CPU가 꼭 주목해야할 떄, CPU가 얼른 처리해야 할 다른 작업이 생길 때 발생
중요한 일이 생겼을 때!
- 종류
    - 동기 인터럽트 (예외) -폴트, 트랩, 중단, 소프트웨어 인터럽트
    CPU가 예기치 못한 상황을 접했을 때 발생 
    
    Ex. 메모리 접근 시 원하는 데이터가 없음, 디버깅, 실행할 수 없는 명령어
    - 비동기 인터럽트(하드웨어 인터럽트)
        - 주로 입출력 장치에 의해 발생하며 알림과 같은 역할을 한다. 
        
         키보드 클릭 → 하드웨어 인터럽트 → CPU 전달 → CPU 알림 인지 → 인터럽트 서비스 루틴을 실행
        - 왜 사용하나? 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 사용
            
         일반적으로 입출력 장치의 입출력 작업은 CPU에 비해 느리다. 입출력 장치의 결과를 확인하기 위해 계속적인 확인이 아닌 알림을 통해 효율적으로 사용 가능하다는 것이다.
            

### 하드웨어 인터럽트의 처리 순서

1. 입출력 장치 →  CPU에 인터럽트 요청 신호
2. CPU는 실행 사이클 끝나고 인출 전 항상 인터럽트 여부 확인 
(실행 - 인터럽트 여부 확인 - 인출 - 실행 반복) 
3. CPU 인터럽트 요청 확인 후 인터럽트 플래그를 통해 인터럽트 실행 가능 여부 확인
4. 인터럽트 받아들일 수 있다면 CPU는 지금까지 작업을 백업한다.
5. CPU는 인터럽트 벡터를 참조해 인터럽트 서비스 루틴을 실행한다.
6. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업해 둔 작업을 복구하여 실행을 재개한다.


- 인터럽트 요청 신호
    - CPU의 작업을 방해하는 인터럽트에 대한 요청
    - 입출력 장치 →  요청 신호 (지금 끼어들어도 되나?)→ CPU
- 인터럽트 플래그
    - 인터럽트 요청 신호를 받아들일지 무시할지 결정하는 비트
    - CPU가 요청 신호를 받아 들이면 실행 사이클이 끝나고 플래그 레지스터에 플래그 인터럽트를 확인한다.
    - 모든 인터럽트를 인터럽트 플래그로 막을 수 있는 건 아니다.
- 인터럽트 서비스 루틴
    - 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하기 위한 프로그램
    - CPU가 인터럽트를 받아들이기로 했을 때 실행
    - 메모리에 저장되어 있다. (인터럽트 서비스 루틴 A,  인터럽트 서비스 루틴 B…등)
- 인터럽트 벡터
    - 인터럽트 서비스 루틴의 시작 주소를 포함하는 인터럽트 서비스 루틴의 식별 정보
    - 인터럽트 + 인터럽트 벡터 데이터 버스를 통해 전달
- 인터럽트 발생 시
    - 현재 작업 내용 레지스터에 담겨 있는 값들은 스택에 넣어둔다.
    - 인터럽트 서비스 루틴을 실행하기 위한 정보들은 레지스터 담긴다.
    - 스택에서 기존 작업 내용을 백업해 온다.

### 명령어 사이클 그림

![Untitled (5)](https://user-images.githubusercontent.com/79884004/228237236-27c8c7c0-5298-4222-a8c1-a4763e9e3fd2.png)

인출, 실행, 간접, 인터럽트 사이클로 구성되어 있다.
