# 프로세스 동기화 기법

### 동기화 기법

1. 뮤텍스 락 
2. 세마포 
3. 모니터 

### 뮤텍스 락

상호배제를 위한 동기화 도구(자물쇠 역할)

형태 

- 자물쇠 역할 : 프로세스들이 공유하는 전역 변수
- 임계 구역 잠금 역할 : 함수 1
- 임계 구역 잠감 해제 역할: 힘수2

임계구역 오픈 여부 확인 후 들어가서 자물쇠 잠금 후 작업 진행 작업 후 자물쇠 다시 오픈 

바쁜 대기 (busy wating) 

```jsx
while(lock === true) // 반복 적인 확인
```

→ CPU 사이클 낭비

### 세마포

- 좀 더 일반화된 방식의 동기화 도구
- 공유 자원이 여러 개 있는 경우에도 적용 가능

종류 

- 이진 세마포
- 카운팅 세마포

해당 챕터에서는 카운팅 세마포를 다룬다. 

- 임계 구역 앞에서 멈춤 신호를 받으면 잠시 기다림
- 임계 구역 앞에서 가도 좋다는 신호를 받으면 임계 구역 진입

형태

- 임계 구역에 진입할 수 있는 프로세스의 개수(사용 가능한 공유 자원의 개수)를 나타내는 **전역 변수 S**
- 임계구역에 들어가도 되는지, 기다려야 할지 알려주는 함수
- 임계구역 앞에서 기다리는 프로세스에 출발 신호를 주는 함수

```jsx
wait()
//임계 구역
signal()  
```

```jsx
wait() {
	while( S <= 0 )  // 만약 임계구역에 진입할 수 있는 프로세스 개수가 0 이하라면
	;                // 사용할 수 있는 자원이 있는지 반복적으로 확인
	S--;             // 임계 구역 진입 가능한 프로세스가 1개 이상이면 S를 1감소 후 임계구역 진입
}

signal() {
	S++;             // 임계 구역에서의 작업을 마친 뒤 S를 1증가
}
```

해결방법

- 사용할 수 있는 자원이 없을 경우 **대기 상태**로 만듦  
(해당 프로세의 PCB를 대기 큐에 삽입)
- 사용할 수 있는 자원이 생겼을 경우 대기 큐의 프로세스를 **준비 상태**로 만듦 
(해당 프로세스의 PCB를 대기 큐에서 꺼내 준비 큐에 삽입 )

세마포를 활용한 실행 순서 동기화 

두 개의 프로세스가 있을 때 세마포를 이용해 실행 순서를 보장 할 수 있다. 

```jsx
 세마포 변수  0 설정  
 process1  - 임계 구역 signal()
 process2 - wait() 임계 구역
```

아쉬운 점 - 임계 구역 앞뒤로 함수 호출

### 모니터

상호 배제를 위한 동기화, 실행 순서 제어를 위한 동기화 방식 제공

- 상호배제를 위한 동기화
    - 인터페이스를 위한 큐
    - 공유자원에 접근하고자 하는 프로세스를 (인터페이스를 위한) 큐에 삽입
    - 큐에 삽입된 순서대로 (한 번에 하나의 프로세스만 ) 공유 자원 이용
    
    공유 자원과 그 공유 자원을 접근하기 위한 통로를 묶어서 관리 
    
    공유 자원의 접근하고자 하는 프로세스와 스레드는 반드시 특정 인터페이스를 통해서 만 접근 하도록 
    
    ![Untitled (10)](https://user-images.githubusercontent.com/79884004/234882422-ed656a5b-81ff-4d68-8c95-5ce9a2d05371.png)
    
- 실행 순서 제어를 위한 동기화
    1. 특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 `wait()`통해 실행 중단.
    2. 특정 프로세스가 실행될 조건이 충족되었을 때에는 `signal()` 을 통해 실행을 재개 
    - 조건 변수 condition variable* 이용 
    *프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수
    
    ![Untitled (11)](https://user-images.githubusercontent.com/79884004/234882450-55157bcc-f7f6-42ee-b446-c5cdfc49df82.png)
    
    조건 변수 `wait()` : 대기 상태로 변경, 조건 변수에 대한 큐에 삽입 
    
    조건 변수 `signal()`:  `wait()` 으로 대기 상태로 접어든 조건 변수를 실행 상태로 변경 
    
    **모니터 안에는 하나의 프로세스만이 있을 수 있다.** 
    
    - `wait()` 를 호출했던 프로세스는 `signal()` 을 호출한 프로세스가 모니터를 떠난 뒤에 수행을 재개
    - `signal()`을 호출한 프로세스의 실행을 일시 중단하고 자신이 실행된 뒤 다시 `signal()`을 호출한 프로세스의  수행을 재개
