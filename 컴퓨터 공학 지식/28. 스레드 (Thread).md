# 28. 스레드

### 스레드 (Thread)

프로세스를 구성하는 **실행 흐름 단위** 

- 실행 흐름 단위?
    - 화면 출력 스레드, 입출력 스레드, 검색 스레드 등
    - 스레드가 여러개가 있다면 여러개의 명령어를 동시에 실행 할 수 있다.
    - 하나의 프로세스를 여러개의 스레드로서 동시에 실행 할 수 있다.

### 프로세스와 스레드

- 실행 흐름이 하나 인 프로세스 (단일 스레드 프로세스)
- 실행 흐름이 여러 개인 프로세스 (멀티 스레드 프로세스)
    - 프로세스를 이루는 여러 명령어 동시 실행 가능

### 스레드의 구성 요소

스레드id, 프로그램 카운터를 비롯한 레지스터 값, 스택 등 

**실행에 필요한 최소한의 정보**

 프로세스를 이루는 스레드들은 그 프로세스 자원을 공유한다 

<img width="500" height="500" src="https://user-images.githubusercontent.com/79884004/232946824-c5a46f71-764d-4e2a-86fb-7f9cb57215e5.png" />

*코드 영역에는 지금 실행 해야 하는 명령어들이 담겨있다.

[중요!]

스레드 1,2,3 병행 실행되고 있지만 모두 똑같은 코드 입력 데이터 영역을 공유하고 있다.

스레드1만의 코드영역 2만의 데이터영역이 이렇게 나뉘지 않고 공유한다. 

이 프로세스가 어떤 파일을 열었으면 모든 스레드들은 그 열린 파일에 접근할 수 있다. 

CPU한테 처리해야 될 작업을 전달할 때 CPU를 할당 받아 실행되는 그 단위는 프로세스 단위가 아니라 각가의 스레드인 경우가 많다. 

### 멀티 프로세스와 멀티 스레드

<img width="500" height="500" src="https://user-images.githubusercontent.com/79884004/232946380-3c21802e-73da-4489-97ad-64ca70adadca.png" />


### **(멀티 프로세스)** 동일한 작업을 수행하는 단일 스레드 프로세스 여러 개 실행
   - 프로세스 fork 시 코드/데이터/힙 영역 등 모든 자원이 복제되어 저장
   - 저장된 메모리 주소를 제외하면 모든 것이 동일한 프로세스 두 개가 통째로 메모리에 적재
   * fork 직후 같은 프로세스를 통째로 **메모리에 중복 저장 X,** 프로세스 끼리 자원 공유하지 않게 하는 방법 ⇒ copy on write 기법
   - 각각의 프로세스는 자원 공유 X → 독립적으로 실행

   <img width="500" src="https://user-images.githubusercontent.com/79884004/232946383-7f19ee53-7b78-4c3e-b62f-d82aefc71c83.png" />   

vs

### **(멀티 스레드)** 하나의 프로세스를 여러 스레드로 실행
   - 스레드들은 각기 다른 스레드 ID를 가진다.
   - 프로그램 카운터 값을 포함한 레지스터 값, 스택을 가진다.
   - 프로세스가 가지는 자원을 공유한다. → 협력과 통신에 유리
   - 자원 공유는 문제를 발생 시킬 수도 있다. ex. 하나의 스레드에 문제가 생기면 자원을 공유하는 다른 스레드에도 문제가 생길 수 있다.
    
   <img width="500" src="https://user-images.githubusercontent.com/79884004/232946385-6df03668-76df-4b37-af68-29cfb54155ef.png" />    


**멀티 스레드 는 각기 다른 PCB값을 가지지만 멀티 스레드는 하나의 PCB값을 가지고 스레드가 공유하는 자원과 스레드 마다 따로 가지는 자원이 있다.**

`* 프로세스끼리는 기본적으로 자원 공유하지 않지만 스레드끼리는 같은 프로세스 내 자원을 공유한다.` 

`* **프로세스가 생성될 때마다 고유의 PCB가 생성**되고, 프로세스가 완료되면 PCB는 제거된다.`

`* 프로그램 카운터: 프로세서 내부 레지스터 중 하나로서, 다음에 실행될 명령어의 주소를 가지고 있어 명령어 포인터로 불린다.`  

프로세스끼리 자원을 공유하지 않지만 자원을 주고받을 수 있다: 프로세스 간 통신 (IPC)

파일을 통한 프로세스 간 통신, 공유 메모리를 통한 프로세스 간 통신
